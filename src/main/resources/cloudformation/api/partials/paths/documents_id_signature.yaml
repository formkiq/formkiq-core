#@ load("@ytt:overlay", "overlay")
#@overlay/match by=overlay.all
---
paths:
  #@overlay/match missing_ok=True
  /documents/{documentId}/signature:
    post:
      operationId: AddDocumentSignature
      description: |-
        Generates a new document and signature to document. Returns a Presigned URL to the newly temporary created document.

        ; available as an Add-On Module
      summary: Add Document Signature
      tags:
        - Document Generation
      parameters:
        - $ref: '#/components/parameters/siteIdParam'
        - $ref: '#/components/parameters/documentIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddDocumentSignatureRequest'
      responses:
        '201':
          description: 201 CREATED
          headers:
            Access-Control-Allow-Origin:
              $ref: '#/components/headers/AccessControlAllowOrigin'
            Access-Control-Allow-Methods:
              $ref: '#/components/headers/AccessControlAllowMethods'
            Access-Control-Allow-Headers:
              $ref: '#/components/headers/AccessControlAllowHeaders'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddDocumentSignatureResponse'
        '400':
          description: 400 OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationErrorsResponse'
      security:
      - ApiAuthorization: []
      x-amazon-apigateway-integration:
        $ref: "#/components/x-amazon-apigateway-integrations/documentSignatureLambdaApi"

components:
  schemas:
    #@overlay/match missing_ok=True
    AddDocumentSignatureRequest:
      type: "object"
      required:
        - secretsManagerKey
        - certificateAlias
      properties:
        secretsManagerKey:
          type: string
          description: "The AWS Secrets Manager Key the certificate is stored under"
        certificateAlias:
          type: string
          description: "The certificate Alias"

    #@overlay/match missing_ok=True
    AddDocumentSignatureResponse:
      type: "object"
      properties:
        documentId:
          type: "string"
          description: "Signed document identifier"
